{
  "version": "1",
  "metadata": {
    "marimo_version": "0.18.4"
  },
  "cells": [
    {
      "id": "MJUe",
      "code_hash": "d74dabc90d4e1df6d0f0dba9e65a10db",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h1 id=\"thunderduck-playground\">Thunderduck Playground</h1>\n<span class=\"paragraph\">Compare <strong>Thunderduck</strong> vs <strong>Apache Spark</strong> performance side-by-side using TPC-H benchmark data.</span>\n<span class=\"paragraph\">This notebook provides:</span>\n<ul>\n<li>Pre-configured PySpark clients for both engines</li>\n<li>TPC-H sample data (SF0.01 - ~3MB, 8 tables)</li>\n<li>Example DataFrame API transformations</li>\n<li>Performance comparison utilities</li>\n</ul>\n<hr />\n<h2 id=\"how-it-works\">How it works</h2>\n<span class=\"paragraph\">Two SparkSession clients are configured:</span>\n<ul>\n<li><code>spark_td</code> \u2192 <strong>Thunderduck</strong> (DuckDB-powered, single-node optimized)</li>\n<li><code>spark_ref</code> \u2192 <strong>Apache Spark</strong> (reference implementation)</li>\n</ul>\n<span class=\"paragraph\">All examples use the <strong>PySpark DataFrame API</strong> (filter, select, groupBy, join, etc.).\nRun any cell to execute transformations on both engines and compare results.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Xref",
      "code_hash": "9545bea5bffb0b467869855185da8103",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"example-1-basic-aggregation\">Example 1: Basic Aggregation</h2>\n<span class=\"paragraph\">Count orders by status - a simple GROUP BY query.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "578a10d9c6afc4635636a76cdc62eb60",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"example-2-filter-and-select\">Example 2: Filter and Select</h2>\n<span class=\"paragraph\">Find high-value line items with discount applied.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Kclp",
      "code_hash": "49d0d750ea666f26e91b39c870f089d2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"example-3-dataframe-api\">Example 3: DataFrame API</h2>\n<span class=\"paragraph\">Same revenue-by-nation query using pure DataFrame operations (no SQL).</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Hstk",
      "code_hash": "e6dc355192efab8f90d1c76fac62f15c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"example-4-window-functions\">Example 4: Window Functions</h2>\n<span class=\"paragraph\">Rank customers by total spending within each nation.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "iLit",
      "code_hash": "5617ad2b7b47d95078381feb838336b4",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"example-5-tpc-h-query-1-pricing-summary\">Example 5: TPC-H Query 1 (Pricing Summary)</h2>\n<span class=\"paragraph\">The classic TPC-H Q1 - tests aggregation over large datasets using DataFrame API.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ROlb",
      "code_hash": "80f0154e2ce887c4a9caaca94925837c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"try-your-own-transformations\">Try Your Own Transformations</h2>\n<span class=\"paragraph\">Edit the DataFrame code below to run your own experiments.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "TqIu",
      "code_hash": "c7d62fa462c015565f2bcc9f257227c5",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><hr />\n<h2 id=\"available-tables\">Available Tables</h2>\n<span class=\"paragraph\">The following TPC-H tables are available via <code>spark.table(\"name\")</code>:</span>\n<table>\n<thead>\n<tr>\n<th>Table</th>\n<th>Description</th>\n<th>Key Columns</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>lineitem</code></td>\n<td>Order line items</td>\n<td>l_orderkey, l_partkey, l_quantity, l_extendedprice</td>\n</tr>\n<tr>\n<td><code>orders</code></td>\n<td>Customer orders</td>\n<td>o_orderkey, o_custkey, o_totalprice, o_orderdate</td>\n</tr>\n<tr>\n<td><code>customer</code></td>\n<td>Customer info</td>\n<td>c_custkey, c_name, c_nationkey</td>\n</tr>\n<tr>\n<td><code>part</code></td>\n<td>Parts catalog</td>\n<td>p_partkey, p_name, p_retailprice</td>\n</tr>\n<tr>\n<td><code>supplier</code></td>\n<td>Suppliers</td>\n<td>s_suppkey, s_name, s_nationkey</td>\n</tr>\n<tr>\n<td><code>partsupp</code></td>\n<td>Part-supplier</td>\n<td>ps_partkey, ps_suppkey, ps_supplycost</td>\n</tr>\n<tr>\n<td><code>nation</code></td>\n<td>Nations</td>\n<td>n_nationkey, n_name, n_regionkey</td>\n</tr>\n<tr>\n<td><code>region</code></td>\n<td>Regions</td>\n<td>r_regionkey, r_name</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"dataframe-api-quick-reference\">DataFrame API Quick Reference</h3>\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"c1\"># Get a table</span>\n<span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">spark</span><span class=\"o\">.</span><span class=\"n\">table</span><span class=\"p\">(</span><span class=\"s2\">&quot;lineitem&quot;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Filter rows</span>\n<span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"o\">.</span><span class=\"n\">col</span><span class=\"p\">(</span><span class=\"s2\">&quot;l_quantity&quot;</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">10</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Select columns</span>\n<span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">select</span><span class=\"p\">(</span><span class=\"s2\">&quot;l_orderkey&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;l_quantity&quot;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Add computed column</span>\n<span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">withColumn</span><span class=\"p\">(</span><span class=\"s2\">&quot;net_price&quot;</span><span class=\"p\">,</span> <span class=\"n\">F</span><span class=\"o\">.</span><span class=\"n\">col</span><span class=\"p\">(</span><span class=\"s2\">&quot;l_extendedprice&quot;</span><span class=\"p\">)</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">F</span><span class=\"o\">.</span><span class=\"n\">col</span><span class=\"p\">(</span><span class=\"s2\">&quot;l_discount&quot;</span><span class=\"p\">)))</span>\n\n<span class=\"c1\"># Aggregate</span>\n<span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupBy</span><span class=\"p\">(</span><span class=\"s2\">&quot;l_returnflag&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">agg</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"o\">.</span><span class=\"n\">sum</span><span class=\"p\">(</span><span class=\"s2\">&quot;l_quantity&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">alias</span><span class=\"p\">(</span><span class=\"s2\">&quot;total_qty&quot;</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># Join tables</span>\n<span class=\"n\">orders</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">lineitem</span><span class=\"p\">,</span> <span class=\"n\">orders</span><span class=\"o\">.</span><span class=\"n\">o_orderkey</span> <span class=\"o\">==</span> <span class=\"n\">lineitem</span><span class=\"o\">.</span><span class=\"n\">l_orderkey</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Window functions</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">pyspark.sql.window</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Window</span>\n<span class=\"n\">window</span> <span class=\"o\">=</span> <span class=\"n\">Window</span><span class=\"o\">.</span><span class=\"n\">partitionBy</span><span class=\"p\">(</span><span class=\"s2\">&quot;col1&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">orderBy</span><span class=\"p\">(</span><span class=\"s2\">&quot;col2&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">withColumn</span><span class=\"p\">(</span><span class=\"s2\">&quot;rank&quot;</span><span class=\"p\">,</span> <span class=\"n\">F</span><span class=\"o\">.</span><span class=\"n\">rank</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">over</span><span class=\"p\">(</span><span class=\"n\">window</span><span class=\"p\">))</span>\n</code></pre></div></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Hbol",
      "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "34c34ec29083f9a19fac66ef508d66f0",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "9dd899087b79912e9a6dcb52743e9881",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "Thunderduck: sc://localhost:15002\nSpark:       sc://localhost:15003\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "lEQa",
      "code_hash": "587d7c270ea37d6999913262f670c316",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "Loaded 8 TPC-H tables: lineitem, orders, customer, part, supplier, partsupp, nation, region\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "PKri",
      "code_hash": "58b216cab6e416588782dd0b538040aa",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "331e1245ace376d39efbb4a6b86da9df",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<div style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'><span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"orders-by-status\">Orders by Status</h3>\n<table>\n<thead>\n<tr>\n<th>Metric</th>\n<th>Thunderduck</th>\n<th>Spark</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Time</strong></td>\n<td>75.1ms</td>\n<td>16.1ms</td>\n</tr>\n<tr>\n<td><strong>Speedup</strong></td>\n<td><strong>0.2x</strong></td>\n<td>1.0x</td>\n</tr>\n<tr>\n<td><strong>Rows</strong></td>\n<td>3</td>\n<td>3</td>\n</tr>\n<tr>\n<td><strong>Match</strong></td>\n<td>\u2713</td>\n<td>-</td>\n</tr>\n</tbody>\n</table></span><marimo-ui-element object-id='SFPL-0' random-id='aaaf2a49-a91b-a5c7-50cd-e1e00ad42551'><marimo-table data-initial-value='[]' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;Results&lt;/span&gt;&lt;/span&gt;&quot;' data-data='&quot;[{&#92;&quot;_marimo_row_id&#92;&quot;:0,&#92;&quot;o_orderstatus&#92;&quot;:&#92;&quot;F&#92;&quot;,&#92;&quot;order_count&#92;&quot;:7304},{&#92;&quot;_marimo_row_id&#92;&quot;:1,&#92;&quot;o_orderstatus&#92;&quot;:&#92;&quot;O&#92;&quot;,&#92;&quot;order_count&#92;&quot;:7333},{&#92;&quot;_marimo_row_id&#92;&quot;:2,&#92;&quot;o_orderstatus&#92;&quot;:&#92;&quot;P&#92;&quot;,&#92;&quot;order_count&#92;&quot;:363}]&quot;' data-total-rows='3' data-total-columns='2' data-max-columns='50' data-banner-text='&quot;&quot;' data-pagination='false' data-page-size='10' data-field-types='[[&quot;o_orderstatus&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;order_count&quot;,[&quot;integer&quot;,&quot;int64&quot;]]]' data-selection='&quot;multi&quot;' data-show-filters='true' data-show-download='true' data-show-column-summaries='false' data-show-data-types='true' data-show-page-size-selector='false' data-show-column-explorer='true' data-show-chart-builder='true' data-row-headers='[]' data-has-stable-row-id='true' data-lazy='false' data-preload='false'></marimo-table></marimo-ui-element></div>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "RGSE",
      "code_hash": "cd21606a49e424f000de9e979cfd0824",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<div style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'><span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"high-value-line-items\">High-Value Line Items</h3>\n<table>\n<thead>\n<tr>\n<th>Metric</th>\n<th>Thunderduck</th>\n<th>Spark</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Time</strong></td>\n<td>49.0ms</td>\n<td>22.3ms</td>\n</tr>\n<tr>\n<td><strong>Speedup</strong></td>\n<td><strong>0.5x</strong></td>\n<td>1.0x</td>\n</tr>\n<tr>\n<td><strong>Rows</strong></td>\n<td>20</td>\n<td>20</td>\n</tr>\n<tr>\n<td><strong>Match</strong></td>\n<td>\u2713</td>\n<td>-</td>\n</tr>\n</tbody>\n</table></span><marimo-ui-element object-id='RGSE-0' random-id='437ba3ce-6ba7-d137-15d0-722493098d47'><marimo-table data-initial-value='[]' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;Results&lt;/span&gt;&lt;/span&gt;&quot;' data-data='&quot;[{&#92;&quot;_marimo_row_id&#92;&quot;:0,&#92;&quot;l_orderkey&#92;&quot;:13829,&#92;&quot;l_partkey&#92;&quot;:1994,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;94799.50&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.00&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;94799.5000&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:1,&#92;&quot;l_orderkey&#92;&quot;:26052,&#92;&quot;l_partkey&#92;&quot;:987,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;94399.00&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.00&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;94399.0000&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:2,&#92;&quot;l_orderkey&#92;&quot;:47971,&#92;&quot;l_partkey&#92;&quot;:994,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;94749.50&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.01&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;93802.0050&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:3,&#92;&quot;l_orderkey&#92;&quot;:47329,&#92;&quot;l_partkey&#92;&quot;:968,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;93448.00&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.00&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;93448.0000&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:4,&#92;&quot;l_orderkey&#92;&quot;:53061,&#92;&quot;l_partkey&#92;&quot;:963,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;93198.00&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.00&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;93198.0000&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:5,&#92;&quot;l_orderkey&#92;&quot;:13159,&#92;&quot;l_partkey&#92;&quot;:998,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;94949.50&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.02&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;93050.5100&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:6,&#92;&quot;l_orderkey&#92;&quot;:52930,&#92;&quot;l_partkey&#92;&quot;:1974,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;93798.50&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.01&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;92860.5150&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:7,&#92;&quot;l_orderkey&#92;&quot;:43463,&#92;&quot;l_partkey&#92;&quot;:972,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;93648.50&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.01&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;92712.0150&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:8,&#92;&quot;l_orderkey&#92;&quot;:8807,&#92;&quot;l_partkey&#92;&quot;:1949,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;92547.00&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.00&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;92547.0000&#92;&quot;},{&#92;&quot;_marimo_row_id&#92;&quot;:9,&#92;&quot;l_orderkey&#92;&quot;:33313,&#92;&quot;l_partkey&#92;&quot;:1947,&#92;&quot;l_quantity&#92;&quot;:&#92;&quot;50.00&#92;&quot;,&#92;&quot;l_extendedprice&#92;&quot;:&#92;&quot;92447.00&#92;&quot;,&#92;&quot;l_discount&#92;&quot;:&#92;&quot;0.00&#92;&quot;,&#92;&quot;net_price&#92;&quot;:&#92;&quot;92447.0000&#92;&quot;}]&quot;' data-total-rows='20' data-total-columns='6' data-max-columns='50' data-banner-text='&quot;&quot;' data-pagination='true' data-page-size='10' data-field-types='[[&quot;l_orderkey&quot;,[&quot;integer&quot;,&quot;int64&quot;]],[&quot;l_partkey&quot;,[&quot;integer&quot;,&quot;int64&quot;]],[&quot;l_quantity&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;l_extendedprice&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;l_discount&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;net_price&quot;,[&quot;string&quot;,&quot;object&quot;]]]' data-selection='&quot;multi&quot;' data-show-filters='true' data-show-download='true' data-show-column-summaries='true' data-show-data-types='true' data-show-page-size-selector='true' data-show-column-explorer='true' data-show-chart-builder='true' data-row-headers='[]' data-has-stable-row-id='true' data-lazy='false' data-preload='false'></marimo-table></marimo-ui-element></div>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "emfo",
      "code_hash": "af987ca63101e51987ecfacf9ef0a3fd",
      "outputs": [],
      "console": []
    },
    {
      "id": "nWHF",
      "code_hash": "06e7cf3be7d9f0561319b59f303d528d",
      "outputs": [],
      "console": []
    },
    {
      "id": "ZHCJ",
      "code_hash": "1aa6edbf254db8bf4a6caddb3cb89099",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "<_InactiveRpcError of RPC that terminated with:\n\tstatus = StatusCode.INTERNAL\n\tdetails = \"Schema analysis failed: Failed to execute query: Binder Error: Could not choose a best candidate function for the function call \"-(STRING_LITERAL, INTERVAL)\". In order to select one, please add explicit type casts.\n\tCandidate functions:\n\t-(DATE, INTERVAL) -> TIMESTAMP\n\t-(TIME, INTERVAL) -> TIME\n\t-(TIMESTAMP, INTERVAL) -> TIMESTAMP\n\t-(TIME WITH TIME ZONE, INTERVAL) -> TIME WITH TIME ZONE\n\t-(TIMESTAMP WITH TIME ZONE, INTERVAL) -> TIMESTAMP WITH TIME ZONE\n\t-(INTERVAL, INTERVAL) -> INTERVAL\n\n\nLINE 1: ... * FROM \"lineitem\" WHERE (l_shipdate <= CAST(('1998-12-01' - INTERVAL '90 days') AS DATE))) AS schema_infer LIMIT 0\n                                                                      ^\"\n\tdebug_error_string = \"UNKNOWN:Error received from peer  {grpc_status:13, grpc_message:\"Schema analysis failed: Failed to execute query: Binder Error: Could not choose a best candidate function for the function call \\\"-(STRING_LITERAL, INTERVAL)\\\". In order to select one, please add explicit type casts.\\n\\tCandidate functions:\\n\\t-(DATE, INTERVAL) -> TIMESTAMP\\n\\t-(TIME, INTERVAL) -> TIME\\n\\t-(TIMESTAMP, INTERVAL) -> TIMESTAMP\\n\\t-(TIME WITH TIME ZONE, INTERVAL) -> TIME WITH TIME ZONE\\n\\t-(TIMESTAMP WITH TIME ZONE, INTERVAL) -> TIMESTAMP WITH TIME ZONE\\n\\t-(INTERVAL, INTERVAL) -> INTERVAL\\n\\n\\nLINE 1: ... * FROM \\\"lineitem\\\" WHERE (l_shipdate <= CAST((\\'1998-12-01\\' - INTERVAL \\'90 days\\') AS DATE))) AS schema_infer LIMIT 0\\n                                                                      ^\"}\"\n>",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/tmp/marimo_40599/__marimo__cell_ZHCJ_.py&quot;</span>, line <span class=\"m\">20</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">tpch_q1</span><span class=\"p\">(</span><span class=\"n\">spark_td</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/tmp/marimo_40599/__marimo__cell_ZHCJ_.py&quot;</span>, line <span class=\"m\">7</span>, in <span class=\"n\">tpch_q1</span>\n<span class=\"w\">    </span><span class=\"o\">.</span><span class=\"n\">groupBy</span><span class=\"p\">(</span><span class=\"s2\">&quot;l_returnflag&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;l_linestatus&quot;</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/workspace/playground/.venv/lib/python3.10/site-packages/pyspark/sql/connect/dataframe.py&quot;</span>, line <span class=\"m\">556</span>, in <span class=\"n\">groupBy</span>\n<span class=\"w\">    </span><span class=\"n\">_cols</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">[</span><span class=\"n\">c</span><span class=\"p\">])</span>\n  File <span class=\"nb\">&quot;/workspace/playground/.venv/lib/python3.10/site-packages/pyspark/sql/connect/dataframe.py&quot;</span>, line <span class=\"m\">1748</span>, in <span class=\"n\">__getitem__</span>\n<span class=\"w\">    </span><span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">verify_col_name</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_schema</span><span class=\"p\">):</span>\n  File <span class=\"nb\">&quot;/workspace/playground/.venv/lib/python3.10/site-packages/pyspark/sql/connect/dataframe.py&quot;</span>, line <span class=\"m\">1841</span>, in <span class=\"n\">_schema</span>\n<span class=\"w\">    </span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_cached_schema</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_session</span><span class=\"o\">.</span><span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">schema</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/workspace/playground/.venv/lib/python3.10/site-packages/pyspark/sql/connect/client/core.py&quot;</span>, line <span class=\"m\">1112</span>, in <span class=\"n\">schema</span>\n<span class=\"w\">    </span><span class=\"n\">schema</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_analyze</span><span class=\"p\">(</span><span class=\"n\">method</span><span class=\"o\">=</span><span class=\"s2\">&quot;schema&quot;</span><span class=\"p\">,</span> <span class=\"n\">plan</span><span class=\"o\">=</span><span class=\"n\">plan</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">schema</span>\n  File <span class=\"nb\">&quot;/workspace/playground/.venv/lib/python3.10/site-packages/pyspark/sql/connect/client/core.py&quot;</span>, line <span class=\"m\">1343</span>, in <span class=\"n\">_analyze</span>\n<span class=\"w\">    </span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_handle_error</span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/workspace/playground/.venv/lib/python3.10/site-packages/pyspark/sql/connect/client/core.py&quot;</span>, line <span class=\"m\">1811</span>, in <span class=\"n\">_handle_error</span>\n<span class=\"w\">    </span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_handle_rpc_error</span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"p\">)</span>\n  File <span class=\"nb\">&quot;/workspace/playground/.venv/lib/python3.10/site-packages/pyspark/sql/connect/client/core.py&quot;</span>, line <span class=\"m\">1891</span>, in <span class=\"n\">_handle_rpc_error</span>\n<span class=\"w\">    </span><span class=\"k\">raise</span> <span class=\"n\">SparkConnectGrpcException</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">rpc_error</span><span class=\"p\">))</span> <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"kc\">None</span>\n<span class=\"gr\">pyspark.errors.exceptions.connect.SparkConnectGrpcException</span>: <span class=\"n\">&lt;_InactiveRpcError of RPC that terminated with:</span>\n<span class=\"x\">\tstatus = StatusCode.INTERNAL</span>\n<span class=\"x\">\tdetails = &quot;Schema analysis failed: Failed to execute query: Binder Error: Could not choose a best candidate function for the function call &quot;-(STRING_LITERAL, INTERVAL)&quot;. In order to select one, please add explicit type casts.</span>\n<span class=\"x\">\tCandidate functions:</span>\n<span class=\"x\">\t-(DATE, INTERVAL) -&gt; TIMESTAMP</span>\n<span class=\"x\">\t-(TIME, INTERVAL) -&gt; TIME</span>\n<span class=\"x\">\t-(TIMESTAMP, INTERVAL) -&gt; TIMESTAMP</span>\n<span class=\"x\">\t-(TIME WITH TIME ZONE, INTERVAL) -&gt; TIME WITH TIME ZONE</span>\n<span class=\"x\">\t-(TIMESTAMP WITH TIME ZONE, INTERVAL) -&gt; TIMESTAMP WITH TIME ZONE</span>\n<span class=\"x\">\t-(INTERVAL, INTERVAL) -&gt; INTERVAL</span>\n\n\n<span class=\"x\">LINE 1: ... * FROM &quot;lineitem&quot; WHERE (l_shipdate &lt;= CAST((&#39;1998-12-01&#39; - INTERVAL &#39;90 days&#39;) AS DATE))) AS schema_infer LIMIT 0</span>\n<span class=\"x\">                                                                      ^&quot;</span>\n<span class=\"x\">\tdebug_error_string = &quot;UNKNOWN:Error received from peer  {grpc_status:13, grpc_message:&quot;Schema analysis failed: Failed to execute query: Binder Error: Could not choose a best candidate function for the function call \\&quot;-(STRING_LITERAL, INTERVAL)\\&quot;. In order to select one, please add explicit type casts.\\n\\tCandidate functions:\\n\\t-(DATE, INTERVAL) -&gt; TIMESTAMP\\n\\t-(TIME, INTERVAL) -&gt; TIME\\n\\t-(TIMESTAMP, INTERVAL) -&gt; TIMESTAMP\\n\\t-(TIME WITH TIME ZONE, INTERVAL) -&gt; TIME WITH TIME ZONE\\n\\t-(TIMESTAMP WITH TIME ZONE, INTERVAL) -&gt; TIMESTAMP WITH TIME ZONE\\n\\t-(INTERVAL, INTERVAL) -&gt; INTERVAL\\n\\n\\nLINE 1: ... * FROM \\&quot;lineitem\\&quot; WHERE (l_shipdate &lt;= CAST((\\&#39;1998-12-01\\&#39; - INTERVAL \\&#39;90 days\\&#39;) AS DATE))) AS schema_infer LIMIT 0\\n                                                                      ^&quot;}&quot;</span>\n<span class=\"x\">&gt;</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "qnkX",
      "code_hash": "4e130a2b7f37e0c127b71582dbf7d2f1",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<div style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'><span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"custom-transformation\">Custom Transformation</h3>\n<table>\n<thead>\n<tr>\n<th>Metric</th>\n<th>Thunderduck</th>\n<th>Spark</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Time</strong></td>\n<td>87.0ms</td>\n<td>19.6ms</td>\n</tr>\n<tr>\n<td><strong>Speedup</strong></td>\n<td><strong>0.2x</strong></td>\n<td>1.0x</td>\n</tr>\n<tr>\n<td><strong>Rows</strong></td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td><strong>Match</strong></td>\n<td>\u2713</td>\n<td>-</td>\n</tr>\n</tbody>\n</table></span><marimo-ui-element object-id='qnkX-0' random-id='3e18a2d0-6df4-b66f-a5bd-2bf465a98b3a'><marimo-table data-initial-value='[]' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;Results&lt;/span&gt;&lt;/span&gt;&quot;' data-data='&quot;[{&#92;&quot;_marimo_row_id&#92;&quot;:0,&#92;&quot;total_lineitems&#92;&quot;:60175,&#92;&quot;total_quantity&#92;&quot;:&#92;&quot;1536127.00&#92;&quot;,&#92;&quot;avg_price&#92;&quot;:&#92;&quot;35765.513261&#92;&quot;}]&quot;' data-total-rows='1' data-total-columns='3' data-max-columns='50' data-banner-text='&quot;&quot;' data-pagination='false' data-page-size='10' data-field-types='[[&quot;total_lineitems&quot;,[&quot;integer&quot;,&quot;int64&quot;]],[&quot;total_quantity&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;avg_price&quot;,[&quot;string&quot;,&quot;object&quot;]]]' data-selection='&quot;multi&quot;' data-show-filters='true' data-show-download='true' data-show-column-summaries='false' data-show-data-types='true' data-show-page-size-selector='false' data-show-column-explorer='true' data-show-chart-builder='true' data-row-headers='[]' data-has-stable-row-id='true' data-lazy='false' data-preload='false'></marimo-table></marimo-ui-element></div>"
          }
        }
      ],
      "console": []
    }
  ]
}